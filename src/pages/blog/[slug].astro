---
/**
 * OWNER: DYNAMIC (Dev B)
 * Blog Detail Page with SSG.
 */
import SiteLayout from '../../layouts/SiteLayout.astro';
import Prose from '../../components/ui/Prose.astro';
import { getPostBySlug, getAllPostsSlugs } from '../../lib/api/endpoints';
import type { WPPost } from '../../types/wp';

export async function getStaticPaths() {
  try {
    const slugs = await getAllPostsSlugs();
    return slugs.map(slug => ({
      params: { slug }
    }));
  } catch (error) {
    console.error("Error generating static paths for blog:", error);
    return [];
  }
}

const { slug } = Astro.params;
let post: WPPost | null = null;

if (slug) {
  try {
    post = await getPostBySlug(slug);
  } catch (e) {
    console.error(`Failed to fetch post: ${slug}`, e);
  }
}

if (!post) {
  return Astro.redirect('/404');
}
---

<SiteLayout title={post.title}>
  <article class="max-w-4xl mx-auto px-4 py-12 sm:px-6 lg:px-8">
    <header class="mb-8 text-center">
      {post.featuredImage && (
        <img 
          src={post.featuredImage.src} 
          alt={post.featuredImage.alt} 
          class="w-full h-64 md:h-96 object-cover rounded-xl shadow-lg mb-8"
        />
      )}
      <div class="flex justify-center gap-2 mb-4 text-sm font-medium text-blue-600">
        {post.categories.map(c => (
          <span class="bg-blue-50 px-3 py-1 rounded-full">{c.name}</span>
        ))}
      </div>
      <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">{post.title}</h1>
      <time class="text-gray-500">{new Date(post.date).toLocaleDateString(undefined, {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      })}</time>
    </header>

    <div class="bg-white p-8 md:p-12 rounded-2xl shadow-sm border border-gray-100">
      <Prose html={post.content} />
    </div>

    <div class="mt-8 text-center">
      <a href="/blog" class="inline-flex items-center text-blue-600 hover:text-blue-800 font-medium">
        &larr; Back to Blog
      </a>
    </div>
  </article>
</SiteLayout>
